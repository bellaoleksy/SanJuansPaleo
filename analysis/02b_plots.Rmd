---
title: "02b_plots"
author: "Julia Pop"
date: "2025-09-22"
output: html_document
---

```{r setup, include=FALSE}
# code to troublesheet file path issues. 
# By default, knitr uses the folder containing the .Rmd file as
# the working directory. This code allows us to set the folder
# with our .rProj in it as the root. 

# find_root looks upwards from the .Rmd until it finds a file or
# folder that matches the criteria "folder with a .Rproj file in
# it."

knitr::opts_knit$set(root.dir = rprojroot::find_root(rprojroot::is_rstudio_project))
```

## Plot themes and packages
```{r, Echo = FALSE}
source("scripts/libraries.R")

#Customize theme 
#http://joeystanley.com/blog/custom-themes-in-ggplot2 
# theme_SJ <- function () { 
#  theme_base(base_size=8, base_family="PT Sans") %+replace% # base size scales everything
 #   theme(
 #     panel.background  = element_blank(), # back panel blank
 #     plot.background = element_rect(fill="white", colour=NA), # plot bgd white, with no border
 #     plot.title=element_text(face="plain",hjust=0), # 
 #     plot.subtitle = element_text(color="dimgrey", hjust=0, size=8), # hjust = left aligned
 #     axis.title=element_text(face="plain"), # face = plain means not bold
 #     panel.grid.minor=element_blank(), # removes minor grid lines
 #     strip.text.x = element_text(face="italic"),
 #     panel.grid.major=element_line(color="lightgrey"))}

# theme_set(theme_paleo())  # pre-set the bw theme
```

# Plotting Preservation Indeces for Peter

## Pull in data
```{r}
all_lakes <- read.csv("output/all_lakes.csv")

UFM_short <- read.csv("output/UFM_short.csv")
LFM_short <- read.csv("output/LFM_short.csv")
TRK_short <- read.csv("output/TRK_short.csv")
```

## Pigment plots for Peter
```{r}

# pigment metric explanations
#         chla_pheoa = chl_a_nmol_gTC + pheo_a_nmol_gTC, 
#         chlb_pheob = chl_b_nmol_gTC + phaeo_b_nmol_gTC,
#         all_chl = chl_a_nmol_gTC + pheo_a_nmol_gTC + chl_ap_nmol_gTC, 
#         PI = chl_a_nmol_gTC/pheo_a_nmol_gTC,
#         AD_ratio = allo_nmol_gTC / diato_nmol_gTC, 
#         master_chl = (chl_a_nmol_gTC + chl_b_nmol_gTC) / (chl_ap_nmol_gTC + pheo_a_nmol_gTC + phaeo_b_nmol_gTC),
#         perc_chlb = (phaeo_b_nmol_gTC / pheo_a_nmol_gTC), 
#         perc_diatox = (diato_nmol_gTC/chla_pheoa)) %>%

# things to plot: 

# include: lake name, depth (plot?), year_CE
# plot: chl_a, pheo_a, all_chl, PI,  diatoxanthin, echineone (total cyanos)

UFM_short %>%
  pivot_longer(d13C:perc_diatox) %>%
  filter(name %in% c("chl_a_nmol_gTC", "pheo_a_nmol_gTC", 
                     "all_chl", "PI", 
                     "diato_nmol_gTC", "echine_nmol_gTC")) %>%
   mutate(name = recode(name, PI = "Preservation Index"), # change name of PI
         name = factor(name, levels = c(
           "chl_a_nmol_gTC",
           "pheo_a_nmol_gTC",
           "all_chl",
           "Preservation Index",
           "diato_nmol_gTC",
           "echine_nmol_gTC"
         ))) %>%
  filter(!is.na(value) & !is.na(depth_top)) %>% # remove missing points to make line continuous
  ggplot(aes(x=depth_top, y=value, color=name))+
  geom_point()+
  geom_line()+
  facet_wrap(.~name, scales="free_y")+
  theme(
    legend.position = "none",
    panel.background = element_rect(fill = "gray96", color = NA),  # gray panels
    panel.grid.major = element_line(color = "white", size = 0.5),  # visible major grid lines
    panel.grid.minor = element_blank(),  # remove minor grid lines
    plot.title = element_text(face = "bold", size = 10, hjust = 0, margin = margin(b=5)),  # bold, larger, centered, margin below
    strip.text.x = element_text(face = "italic", hjust = 0, size = 8)  # left-align facet titles
  ) + 
  scale_x_reverse() + 
  labs(
    title = "UFM Pigments",
    x = "Depth (cm)",
    y = expression(paste("Concentration (nmol ", g^{-1}, " TC)"))) + 
    scale_color_manual(values = c(
    "chl_a_nmol_gTC" = "#E69F00",      # orange
    "pheo_a_nmol_gTC" = "#56B4E9",     # sky blue
    "all_chl" = "#009E73",             # green
    "Preservation Index" = "gold2",  # yellow
    "diato_nmol_gTC" = "#0072B2",      # blue
    "echine_nmol_gTC" = "#D55E00"      # reddish-orange
  ))

LFM_short %>%
  pivot_longer(d13C:perc_diatox) %>%
  filter(name %in% c("chl_a_nmol_gTC", "pheo_a_nmol_gTC", 
                     "all_chl", "PI", 
                     "diato_nmol_gTC", "echine_nmol_gTC")) %>%
   mutate(name = recode(name, PI = "Preservation Index"), # change name of PI
         name = factor(name, levels = c(
           "chl_a_nmol_gTC",
           "pheo_a_nmol_gTC",
           "all_chl",
           "Preservation Index",
           "diato_nmol_gTC",
           "echine_nmol_gTC"
         ))) %>%
  filter(!is.na(value) & !is.na(depth_top)) %>% # remove missing points to make line continuous
  ggplot(aes(x=depth_top, y=value, color=name))+
  geom_point()+
  geom_line()+
  facet_wrap(.~name, scales="free_y")+
  theme(
    legend.position = "none",
    panel.background = element_rect(fill = "gray96", color = NA),  # gray panels
    panel.grid.major = element_line(color = "white", size = 0.5),  # visible major grid lines
    panel.grid.minor = element_blank(),  # remove minor grid lines
    plot.title = element_text(face = "bold", size = 10, hjust = 0, margin = margin(b=5)),  # bold, larger, centered, margin below
    strip.text.x = element_text(face = "italic", hjust = 0, size = 8)  # left-align facet titles
  ) + 
  scale_x_reverse() + 
  labs(
    title = "LFM Pigments",
    x = "Depth (cm)",
    y = expression(paste("Concentration (nmol ", g^{-1}, " TC)"))) + 
    scale_color_manual(values = c(
    "chl_a_nmol_gTC" = "#E69F00",      # orange
    "pheo_a_nmol_gTC" = "#56B4E9",     # sky blue
    "all_chl" = "#009E73",             # green
    "Preservation Index" = "gold2",  # yellow
    "diato_nmol_gTC" = "#0072B2",      # blue
    "echine_nmol_gTC" = "#D55E00"      # reddish-orange
  ))

TRK_short %>%
  pivot_longer(d13C:perc_diatox) %>%
  filter(name %in% c("chl_a_nmol_gTC", "pheo_a_nmol_gTC", 
                     "all_chl", "PI", 
                     "diato_nmol_gTC", "echine_nmol_gTC")) %>%
   mutate(name = recode(name, PI = "Preservation Index"), # change name of PI
         name = factor(name, levels = c(
           "chl_a_nmol_gTC",
           "pheo_a_nmol_gTC",
           "all_chl",
           "Preservation Index",
           "diato_nmol_gTC",
           "echine_nmol_gTC"
         ))) %>%
  filter(!is.na(value) & !is.na(depth_top)) %>% # remove missing points to make line continuous
  ggplot(aes(x=depth_top, y=value, color=name))+
  geom_point()+
  geom_line()+
  facet_wrap(.~name, scales="free_y")+
  theme(
    legend.position = "none",
    panel.background = element_rect(fill = "gray96", color = NA),  # gray panels
    panel.grid.major = element_line(color = "white", size = 0.5),  # visible major grid lines
    panel.grid.minor = element_blank(),  # remove minor grid lines
    plot.title = element_text(face = "bold", size = 10, hjust = 0, margin = margin(b=5)),  # bold, larger, centered, margin below
    strip.text.x = element_text(face = "italic", hjust = 0, size = 8)  # left-align facet titles
  ) + 
  scale_x_reverse() + 
  labs(
    title = "TRK Pigments",
    x = "Depth (cm)",
    y = expression(paste("Concentration (nmol ", g^{-1}, " TC)"))) + 
    scale_color_manual(values = c(
    "chl_a_nmol_gTC" = "#E69F00",      # orange
    "pheo_a_nmol_gTC" = "#56B4E9",     # sky blue
    "all_chl" = "#009E73",             # green
    "Preservation Index" = "gold2",  # yellow
    "diato_nmol_gTC" = "#0072B2",      # blue
    "echine_nmol_gTC" = "#D55E00"      # reddish-orange
  ))
```

## GREEBS Nutrient Plots (NOTE: No axis lables!)
```{r}
# Create nutrient plot
nutrient_plot <- all_lakes %>%
  pivot_longer(d13C:perc_diatox) %>%
  filter(name %in% c("d13C",
           "d15N",
           "percent.C",
           "percent.N",
           "C.N"
  )) %>%
  mutate(name = recode(name, percent.C = "Total C (% dry mass)",   # change column names to change facet labels
                        percent.N = "N (% dry mass)",
                        C.N = "C:N ratio", 
                        d13C = "d13C (‰)",
                        d15N = "d15N (‰)"),
         name = factor(name, levels = c( # order plots
           "d13C (‰)",
           "d15N (‰)",
           "Total C (% dry mass)",
           "N (% dry mass)",
           "C:N ratio" 
         ))) %>%
  filter(!is.na(value) & !is.na(depth_top)) %>% # remove missing points to make line continuous
  ggplot(aes(x=depth_top, y=value, color=lake_name))+
  labs(x = NULL, y = NULL)+
  geom_point()+
  geom_line(size = 1.2) + 
  facet_grid(name ~ ., scales = "free_y") + 
  theme(
    legend.position = "right",
    panel.background = element_rect(fill = "gray99", color = NA),  # gray panels
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),  # remove grid lines
    plot.title = element_text(face = "bold", size = 10, hjust = 0, margin = margin(b=5)),  # bold, larger, centered, margin below
    strip.text = element_blank(),  # remove default facet labels
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1.2),  # black border
    axis.text.x = element_text(size = 16),   # x-axis ticks
    axis.text.y = element_text(size = 16),    # y-axis ticks
    legend.text  = element_text(size = 14),  # legend labels
  ) + 
  guides(color = guide_legend(override.aes = list(size = 2))) +
  scale_x_reverse() + 
  scale_color_manual( breaks = c("Upper Fourmile Lake", "Lower Fourmile Lake", "Turkey Creek Lake"), 
    values = c( 
    "Upper Fourmile Lake" = "yellowgreen",  # 
    "Lower Fourmile Lake" = "#0072B2",  # 
    "Turkey Creek Lake" = "#D55E00"))

# save plots (with set dimensions)
ggsave("figures/nutrient_profiles.png", nutrient_plot, width = 8, height = 15, units = "in", dpi = 400) 

```

## GREEBS Pigment Plots
```{R}

# create a 4 x 2 plot!

pigment_order <- c(
  "chl_a_nmol_gTC", 
  "pheo_a_nmol_gTC", 
  "PI", 
  "lutein_nmol_gTC", 
  "diato_nmol_gTC", 
  "allo_nmol_gTC", 
  "echine_nmol_gTC", 
  "cantha_nmol_gTC"
)

# Create nutrient plot
pigment_plot_GREEBS <- all_lakes %>%
  pivot_longer(d13C:perc_diatox) %>%
  filter(name %in% c("chl_a_nmol_gTC", "pheo_a_nmol_gTC", "PI", "lutein_nmol_gTC", 
                     "diato_nmol_gTC", "allo_nmol_gTC", "echine_nmol_gTC", "cantha_nmol_gTC"
  )) %>%
  filter(!is.na(value) & !is.na(depth_top)) %>% # remove missing points to make line continuous
  mutate(name = factor(name, levels = pigment_order)) %>%   # set facet order
  ggplot(aes(x=depth_top, y=value, color=lake_name))+
  labs(x = NULL, y = NULL)+
  geom_point()+
  geom_line(size = 1.2) + 
  facet_wrap(~ name, scales = "free_y", nrow = 2, ncol = 4) +   # 2 rows, 4 columns
  theme(
    legend.position = "none", # remove legend (saved in figures folder)
    panel.background = element_rect(fill = "gray99", color = NA),  # gray panels
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),  # remove grid lines
    plot.title = element_text(face = "bold", size = 10, hjust = 0, margin = margin(b=5)),  # bold, larger, centered, margin below
    strip.text = element_blank(),  # remove default facet labels
    panel.border = element_rect(color = "black", fill = NA, size = 0.8),  # black border
    axis.text.x = element_text(size = 14),   # x-axis ticks
    axis.text.y = element_text(size = 14),    # y-axis ticks
    panel.spacing.x = unit(0.2, "in"),   # increase space between columns
    panel.spacing.y = unit(0.7, "in"),
  ) + 
  scale_x_reverse() +  # top ticks, no labels
  scale_color_manual( 
    values = c( 
    "Upper Fourmile Lake" = "yellowgreen",  # 
    "Lower Fourmile Lake" = "#0072B2",  # 
    "Turkey Creek Lake" = "#D55E00"))

# save plots (with set dimensions)
ggsave("figures/GREEBS_pigments.png", pigment_plot_GREEBS, width = 14, height = 5, units = "in", dpi = 300) 

# has no units, will go back and add those manually (can check quickly by deleting "strip.text = ..." line)

```

##Pigment flux plots
```{R}

# create a 4 x 2 plot!

pigment_flux_order <- c(
  "chl_a_flux", 
  "pheo_a_flux", 
  "PI", 
  "lutein_flux", 
  "diato_flux", 
  "allo_flux", 
  "echine_flux", 
  "cantha_flux"
)

# Create nutrient plot
pigment_flux_plot <- 
  all_lakes %>%
  pivot_longer(cols = c(bd:year_CE_top, year_CE_bottom:s), names_to = "name", values_to = "value") %>%
  filter(name %in% c(
    "year_CE_plot", "chl_a_flux", "pheo_a_flux", "PI", "lutein_flux",
    "diato_flux", "allo_flux", "echine_flux", "cantha_flux"
  )) %>% # filter instead of select bc these are rows after using pivot...
  # filter(!is.na(value) & !is.na(depth_top)) %>% # remove missing points to make line continuous
  mutate(name = factor(name, levels = pigment_flux_order)) %>%   # set facet order
  ggplot(aes(x=year_CE_plot, y=value, color=lake_name))+
  labs(x = NULL, y = NULL)+
  geom_point()+
  geom_line(size = 1.2) + 
  facet_wrap(~ name, scales = "free_y", nrow = 2, ncol = 4) +   # 2 rows, 4 columns
  theme(
    legend.position = "none", # remove legend (saved in figures folder)
    panel.background = element_rect(fill = "gray99", color = NA),  # gray panels
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),  # remove grid lines
    plot.title = element_text(face = "bold", size = 10, hjust = 0, margin = margin(b=5)),  # bold, larger, centered, margin below
    strip.text = element_blank(),  # remove default facet labels
    panel.border = element_rect(color = "black", fill = NA, size = 0.8),  # black border
    axis.text.x = element_text(size = 14),   # x-axis ticks
    axis.text.y = element_text(size = 14),    # y-axis ticks
    panel.spacing.x = unit(0.2, "in"),   # increase space between columns
    panel.spacing.y = unit(0.7, "in"),
  ) + 
  scale_color_manual( 
    values = c( 
    "Upper Fourmile Lake" = "yellowgreen",  # 
    "Lower Fourmile Lake" = "#0072B2",  # 
    "Turkey Creek Lake" = "#D55E00"))

# save plots (with set dimensions)
ggsave("figures/pigment_flux_plot.png", pigment_flux_plot, width = 14, height = 5, units = "in", dpi = 300) 

# has no units, will go back and add those manually (can check quickly by deleting "strip.text = ..." line)
```
